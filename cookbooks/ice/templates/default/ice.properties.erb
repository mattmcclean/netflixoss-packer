#
## Ice Configuration File
#
## Dynamically generated by Chef on <%= node['fqdn'] %>
##
## Local modifications will be overwritten by Chef.
##

ice.processor=<%= node['ice']['processor']['enabled'] ? 'true' : 'false' %>
ice.processor.localDir=<%= node['ice']['processor']['local_dir'] %>

ice.reader=<%= node['ice']['reader']['enabled'] ? 'true' : 'false' %>
ice.reader.localDir=<%= node['ice']['reader']['local_dir'] %>

ice.work_s3bucketname=<%= node['ice']['work_s3_bucket_name'] %>
ice.work_s3bucketprefix=<%= node['ice']['work_s3_bucket_prefix'] %>

ice.startmillis=<%= node['ice']['start_millis'] %>

<% if !node['ice']['s3AccessKeyId'].nil? %>
ice.s3AccessKeyId=<%= node['ice']['s3AccessKeyId'] %>
<% end %>
<% if !node['ice']['s3SecretKey'].nil? %>
ice.s3SecretKey=<%= node['ice']['s3SecretKey'] %>
<% end %>

<% if !node['ice']['payer_accounts'].nil? && node['ice']['payer_accounts'].any? %>
ice.billing_s3bucketname=<%= node['ice']['payer_accounts'].map{|x| x.map {|k,v| "#{v}" if (k=='billing_s3_bucketname')}.compact}.join(',') %>
ice.billing_s3bucketprefix=<%= node['ice']['payer_accounts'].map{|x| x.map {|k,v| "#{v}" if (k=='billing_s3_bucketprefix')}.compact}.join(',') %>
ice.billing_payerAccountId=<%= node['ice']['payer_accounts'].map{|x| x.map {|k,v| "#{v}" if (k=='accountid')}.compact}.join(',') %>
#ice.billing_accessRoleName=<%= node['ice']['payer_accounts'].map{|x| x.map {|k,v| "#{v}" if (k=='access_role_name')}.compact}.join(',') %>

<% node['ice']['payer_accounts'].each do |account| %>
ice.account.<%= account['name'] %>=<%= account['accountid'] %>
<% if account['linked_accounts'].any? %>
<% account['linked_accounts'].each do |linked_account| %>
ice.account.<%= linked_account['name'] %>=<%= linked_account['accountid'] %>
<% end %>
<% end %>
<% end %>
<% end %>

ice.companyName=<%= node['ice']['company_name'] %>
